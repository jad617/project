#! /bin/bash

cd "$(dirname "$0")"

#-------------------------------------Nagios Installation-------------------
apt-get update && apt-get upgrade -y
apt-get install -y --force-yes nagios3 nagios-plugins

usermod -a -G nagios www-data
chmod -R +x /var/lib/nagios3/


#---------------------------Reconfiguring the folders layout----------------
mkdir -p /etc/nagios3/openstack/{conf.d,templates,hosts,misc}
mkdir -p /etc/nagios3/openstack/hosts/{controllers,computes}

cp sources/nagios.cfg /etc/nagios3/nagios.cfg
cp sources/generic-network-service.cfg /etc/nagios3/openstack/templates/  
cp sources/generic-passive-service.cfg /etc/nagios3/openstack/templates/
cp sources/linux_server_template.cfg /etc/nagios3/openstack/templates/

cp sources/services.cfg /etc/nagios3/openstack/conf.d/services.cfg
cp sources/hostgroups.cfg /etc/nagios3/openstack/conf.d/hostgroups.cfg
cp sources/commands.cfg /etc/nagios3/openstack/conf.d/commands.cfg


cd /etc/nagios3/conf.d/
mkdir ORIG

cp generic-service_nagios2.cfg ../openstack/templates/generic-service-templates.cfg
mv generic-service_nagios2.cfg ORIG/generic-service.cfg.ORIG

mv hostgroups_nagios2.cfg ORIG/hostgroups.cfg.ORIG

cp generic-host_nagios2.cfg ../openstack/templates/generic-host-templates.cfg
mv generic-host_nagios2.cfg ORIG/generic-host_nagios2.cfg.ORIG

cp contacts_nagios2.cfg ../openstack/conf.d/contacts.cfg
mv contacts_nagios2.cfg ORIG/contacts.cfg.ORIG

cp extinfo_nagios2.cfg extinfo.cfg
mv extinfo_nagios2.cfg ORIG/extinfo.cfg.ORIG

cp timeperiods_nagios2.cfg timeperiods.cfg
mv timeperiods_nagios2.cfg ORIG/timeperiods.cfg.ORIG

mv services_nagios2.cfg ORIG/services.cfg.ORIG

cp localhost_nagios2.cfg localhost.cfg
mv localhost_nagios2.cfg ORIG/localhost.cfg.ORIG

rm -rf /etc/nagios3/conf.d/extinfo.cfg

#---------------------------Host Definition---------------------------
#This will add the Controller Hosts and Compute Hosts

cd ~/project/nagios_scrips

bash child_scripts/nagios_define_host 

service nagios3 restart
service apache2 restart
