0) sudo vim /etc/ceph/ceph.conf

[global]
fsid = 7151ad9d-3afe-4348-bc4b-4efa92233615
public network = 192.168.197.0/24
auth cluster required = cephx
auth service required = cephx
auth client required = cephx
osd journal size = 1024
filestore xattr use omap = true
osd pool default size = 2
osd pool default min size = 1
osd pool default pg num = 333
osd pool default pgp num = 333
osd crush chooseleaf type = 1

keyring = /etc/ceph/ceph.client.admin.keyring

mon initial members = controller
mon host = 10.0.0.11



1)
ceph-authtool --create-keyring /tmp/ceph.mon.keyring --gen-key -n mon. --cap mon 'allow *'
#creating /tmp/ceph.mon.keyring

cat /tmp/ceph.mon.keyring 
[mon.]
	key = AQByHXRWJGbtLBAAfMJ9qsF0iELx0s7gN9qH6A==
	caps mon = "allow *"


2)
ceph-authtool --create-keyring /etc/ceph/ceph.client.admin.keyring --gen-key -n client.admin --set-uid=0 --cap mon 'allow *' --cap osd 'allow *' --cap mds 'allow'
#creating /etc/ceph/ceph.client.admin.keyring


cat /etc/ceph/ceph.client.admin.keyring 
[client.admin]
	key = AQDwHXRWrsHGIxAARgq26rEpk3G6Uociv2UlRw==
	auid = 0
	caps mds = "allow"
	caps mon = "allow *"
	caps osd = "allow *"

3)

ceph-authtool /tmp/ceph.mon.keyring --import-keyring /etc/ceph/ceph.client.admin.keyring
#importing contents of /etc/ceph/ceph.client.admin.keyring into /tmp/ceph.mon.keyring

cat /tmp/ceph.mon.keyring 
[mon.]
	key = AQByHXRWJGbtLBAAfMJ9qsF0iELx0s7gN9qH6A==
	caps mon = "allow *"
[client.admin]
	key = AQDwHXRWrsHGIxAARgq26rEpk3G6Uociv2UlRw==
	auid = 0
	caps mds = "allow"
	caps mon = "allow *"
	caps osd = "allow *"

4)

monmaptool --create --add controller 10.0.0.11 --fsid 7151ad9d-3afe-4348-bc4b-4efa92233615 /tmp/monmap
#monmaptool: monmap file /tmp/monmap
#monmaptool: set fsid to 7151ad9d-3afe-4348-bc4b-4efa92233615
#monmaptool: writing epoch 0 to /tmp/monmap (1 monitors)

5)

sudo mkdir /var/lib/ceph/mon/ceph-controller

6)

########A revoir***********************
ceph-mon --mkfs -i controller --monmap /tmp/monmap --keyring /tmp/ceph.mon.keyring
#ceph-mon: set fsid to 7151ad9d-3afe-4348-bc4b-4efa92233615
#ceph-mon: created monfs at /var/lib/ceph/mon/ceph-controller for mon.controller

7)

sudo touch /var/lib/ceph/mon/ceph-controller/done

sudo start ceph-mon id=controller

sudo touch /var/lib/ceph/mon/ceph-controller/upstart


*****************************************************************OLD BUT WORKED BEFORE********************************

wget -q -O- 'https://download.ceph.com/keys/release.asc' | sudo apt-key add -
apt-add-repository 'deb http://download.ceph.com/debian-hammer/ trusty main'
wget -q http://download.ceph.com/debian-hammer/pool/main/c/ceph/ceph_0.94.5-1trusty_amd64.deb
apt-get update

dpkg -i ceph_0.94.5-1trusty_amd64.deb
apt-get update
apt-get install -y libaio1 libsnappy1 libcurl3 curl libgoogle-perftools4 libgoogle-perftools4 google-perftools libleveldb1
apt-get -f install
apt-get install -y libaio1 libsnappy1 libcurl3 curl libgoogle-perftools4 libgoogle-perftools4 google-perftools libleveldb1
dpkg -i ceph_0.94.5-1trusty_amd64.deb
apt-get install -y libaio1 libsnappy1 libcurl3 curl libgoogle-perftools4 libgoogle-perftools4 google-perftools libleveldb1
apt-get -f install
apt-get update && sudo apt-get install -y ceph
apt-get install -y qemu
apt-get install -y libvirt-bin



#! /bin/bash

cd /etc/ceph/

echo -e "[global]
fsid = $ceph_fsid
public network = $public_network
auth cluster required = cephx
auth service required = cephx
auth client required = cephx
osd journal size = 1024
filestore xattr use omap = true
osd pool default size = 2
osd pool default min size = 1
osd pool default pg num = 333
osd pool default pgp num = 333
osd crush chooseleaf type = 1

#keyring = /etc/ceph/ceph.client.admin.keyring

[mon.$HOSTNAME]
    host = $HOSTNAME
    mon addr = 10.10.10.11:6789
    mon data = /var/lib/ceph/mon/$cluster_name-$HOSTNAME

" > /etc/ceph/ceph.conf

ceph-authtool --create-keyring /tmp/ceph.mon.keyring --gen-key -n mon. --cap mon 'allow *'
ceph-authtool --create-keyring /etc/ceph/ceph.client.admin.keyring --gen-key -n client.admin --set-uid=0 --cap mon 'allow *' --cap osd 'allow *'
cat /tmp/ceph.mon.keyring
ceph-authtool /tmp/ceph.mon.keyring --import-keyring /etc/ceph/ceph.client.admin.keyring
cat /tmp/ceph.mon.keyring

monmaptool --create --generate -c /etc/ceph/ceph.conf /tmp/monmap

mkdir /var/lib/ceph/mon/ceph-controller
ceph-mon --mkfs -i controller --monmap /tmp/monmap --keyring /tmp/ceph.mon.keyring

touch /var/lib/ceph/mon/ceph-controller/done

start ceph-mon id=controller
touch /var/lib/ceph/mon/ceph-controller/upstart
ceph -s
ceph osd lspools










